<!-- UserRestProcess BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Mon Mar 05 12:13:11 IST 2012 -->
<bpel:process name="UserRestProcess" targetNamespace="http://wso2.org/bps/sample"
	suppressJoinFailure="yes" xmlns:tns="http://wso2.org/bps/sample"
	xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
	xmlns:ns="http://ode/bpel/test/userservice" xmlns:ns1="http://www.w3.org/2001/XMLSchema">

	<!-- Import the client WSDL -->
	<bpel:import namespace="http://ode/bpel/test/userservice"
		location="UserService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import location="UserRestProcessArtifacts.wsdl"
		namespace="http://wso2.org/bps/sample" importType="http://schemas.xmlsoap.org/wsdl/" />

	<!-- ================================================================= -->
	<!-- PARTNERLINKS -->
	<!-- List of services participating in this BPEL process -->
	<!-- ================================================================= -->
	<bpel:partnerLinks>
		<!-- The 'client' role represents the requester of this service. -->
		<bpel:partnerLink name="client" partnerLinkType="tns:UserRestProcess"
			myRole="UserRestProcessProvider" />
		<bpel:partnerLink name="RestProcessPutPL"
			partnerLinkType="tns:RestProcessPutPLT" partnerRole="RestProcessPutPLRole"></bpel:partnerLink>
		<bpel:partnerLink name="RestProcessPostPL"
			partnerLinkType="tns:RestProcessPostPLT" partnerRole="RestProcessPostRole"></bpel:partnerLink>
		<bpel:partnerLink name="RestProcessGetPL"
			partnerLinkType="tns:RestProcessGetPLT" partnerRole="RestProcessGetRole"></bpel:partnerLink>
		<bpel:partnerLink name="RestProcessDeletePL"
			partnerLinkType="tns:RestProcessDeletePLT" partnerRole="RestProcessDeleteRole"></bpel:partnerLink>
	</bpel:partnerLinks>

	<!-- ================================================================= -->
	<!-- VARIABLES -->
	<!-- List of messages and XML documents used within this BPEL process -->
	<!-- ================================================================= -->
	<bpel:variables>
		<!-- Reference to the message passed as input during initiation -->
		<bpel:variable name="input" messageType="tns:UserRestProcessRequestMessage" />

		<!-- Reference to the message that will be returned to the requester -->
		<bpel:variable name="output" messageType="tns:UserRestProcessResponseMessage" />
		<bpel:variable name="RestProcessPutPLResponse"
			messageType="ns:putUserNameResponse"></bpel:variable>
		<bpel:variable name="RestProcessPutPLRequest"
			messageType="ns:putUserNameRequest"></bpel:variable>
		<bpel:variable name="RestProcessPostPLResponse"
			messageType="ns:postUserNameResponse"></bpel:variable>
		<bpel:variable name="RestProcessPostPLRequest"
			messageType="ns:postUserNameRequest"></bpel:variable>
		<bpel:variable name="RestProcessGetPLResponse"
			messageType="ns:getUserNameResponse"></bpel:variable>
		<bpel:variable name="RestProcessGetPLRequest"
			messageType="ns:getUserNameRequest"></bpel:variable>
		<bpel:variable name="RestProcessDeletePLResponse"
			messageType="ns:deleteUserNameResponse"></bpel:variable>
		<bpel:variable name="RestProcessDeletePLRequest"
			messageType="ns:deleteUserNameRequest"></bpel:variable>

	</bpel:variables>

	<!-- ================================================================= -->
	<!-- ORCHESTRATION LOGIC -->
	<!-- Set of activities coordinating the flow of messages across the -->
	<!-- services integrated within this business process -->
	<!-- ================================================================= -->
	<bpel:sequence name="main">

		<!-- Receive input from requester. Note: This maps to operation defined 
			in UserRestProcess.wsdl -->
		<bpel:receive name="receiveInput" partnerLink="client"
			portType="tns:UserRestProcess" operation="process" variable="input"
			createInstance="yes" />

		<!-- Generate reply to synchronous request -->

		<bpel:assign validate="no" name="AssignInputForPut">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<ignore:user xmlns:ignore="http://wso2.org/bps/ignorens"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<uid>uid</uid>
							<uname>uname</uname>

						</ignore:user>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="RestProcessPutPLRequest" part="user"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:id]]></bpel:query>
				</bpel:from>
				<bpel:to part="user" variable="RestProcessPutPLRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[uid]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:name]]></bpel:query>
				</bpel:from>
				<bpel:to part="user" variable="RestProcessPutPLRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[uname]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>
		<bpel:invoke name="putUser" partnerLink="RestProcessPutPL"
			operation="putUserName" portType="ns:UserServicePutPT" inputVariable="RestProcessPutPLRequest"
			outputVariable="RestProcessPutPLResponse"></bpel:invoke>

		<bpel:assign validate="no" name="AssignInputForPost">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<ignore:user xmlns:ignore="http://wso2.org/bps/ignorens"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<uid>uid</uid>
							<uname>uname</uname>

						</ignore:user>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="RestProcessPostPLRequest" part="user"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from>
                    <![CDATA[concat(string($input.payload/tns:name),"@wso2.com")]]>
				</bpel:from>
				<bpel:to part="user" variable="RestProcessPostPLRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[uname]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:id]]></bpel:query>
				</bpel:from>
				<bpel:to part="user" variable="RestProcessPostPLRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[uid]]></bpel:query>
				</bpel:to>
			</bpel:copy>

		</bpel:assign>
		<bpel:invoke name="postUser" partnerLink="RestProcessPostPL"
			operation="postUserName" portType="ns:UserServicePostPT"
			inputVariable="RestProcessPostPLRequest" outputVariable="RestProcessPostPLResponse"></bpel:invoke>

		<bpel:assign validate="no" name="AssignInputForGet">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<ignore:userID xmlns:ignore="http://wso2.org/bps/ignorens"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<uid>uid</uid>

						</ignore:userID>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="RestProcessGetPLRequest" part="userID"></bpel:to>
			</bpel:copy>


			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:id]]></bpel:query>
				</bpel:from>
				<bpel:to part="userID" variable="RestProcessGetPLRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[uid]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>
		<bpel:invoke name="getUser" partnerLink="RestProcessGetPL"
			operation="getUserName" portType="ns:UserServiceGetPT" inputVariable="RestProcessGetPLRequest"
			outputVariable="RestProcessGetPLResponse"></bpel:invoke>

		<bpel:assign validate="no" name="AssignInputForDelete">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<ignore:userID xmlns:ignore="http://wso2.org/bps/ignorens"
							xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<uid>uid</uid>

						</ignore:userID>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="RestProcessDeletePLRequest" part="user"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:id]]></bpel:query>
				</bpel:from>
				<bpel:to part="user" variable="RestProcessDeletePLRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[uid]]></bpel:query>
				</bpel:to>
			</bpel:copy>

		</bpel:assign>
		<bpel:invoke name="deleteUser" partnerLink="RestProcessDeletePL"
			operation="deleteUserName" portType="ns:UserServiceDeletePT"
			inputVariable="RestProcessDeletePLRequest" outputVariable="RestProcessDeletePLResponse"></bpel:invoke>

		<bpel:assign validate="no" name="AssignResponsesForOutput">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<tns:UserRestProcessResponse
							xmlns:tns="http://wso2.org/bps/sample" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<tns:put>tns:put</tns:put>
							<tns:post>tns:post</tns:post>
							<tns:get>tns:get</tns:get>
							<tns:delete>tns:delete</tns:delete>
						</tns:UserRestProcessResponse>
					</bpel:literal>
				</bpel:from>
				<bpel:to variable="output" part="payload"></bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="userName" variable="RestProcessGetPLResponse"></bpel:from>
				<bpel:to part="payload" variable="output">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:get]]>
					</bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="part" variable="RestProcessPostPLResponse"></bpel:from>
				<bpel:to part="payload" variable="output">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:post]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="part" variable="RestProcessPutPLResponse"></bpel:from>
				<bpel:to part="payload" variable="output">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:put]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="part" variable="RestProcessDeletePLResponse"></bpel:from>
				<bpel:to part="payload" variable="output">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:delete]]></bpel:query>
				</bpel:to>
			</bpel:copy>
		</bpel:assign>
		<bpel:reply name="replyOutput" partnerLink="client"
			portType="tns:UserRestProcess" operation="process" variable="output" />
	</bpel:sequence>
</bpel:process>

